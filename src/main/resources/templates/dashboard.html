<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <link rel="icon" href="/images/favicon.png">
    <meta charset="UTF-8">
    <title>DIVY - ëŒ€ì‹œë³´ë“œ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" as="style" crossorigin
          href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: "Pretendard", -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(180deg, #F8FAFB 0%, #F2F4F6 100%);
            min-height: 100vh;
            color: #191F28;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 16px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-menu { display: flex; align-items: center; gap: 24px; }
        .nav-menu a {
            text-decoration: none;
            color: #4E5968;
            font-weight: 600;
            font-size: 15px;
            transition: color 0.2s;
        }
        .nav-menu a:hover { color: #3182F6; }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 32px;
        }

        /* í—¤ë” */
        .dashboard-header {
            margin-bottom: 40px;
            animation: fadeInDown 0.6s ease-out;
        }

        .welcome-text {
            font-size: 32px;
            font-weight: 800;
            color: #191F28;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .welcome-sub {
            font-size: 16px;
            color: #8B95A1;
        }

        /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 2.5fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
            background: white;
            border-radius: 24px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.6s ease-out backwards;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(49, 130, 246, 0.12);
        }

        /* ìˆ«ì ì¹´ë“œ */
        .stat-card {
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(49, 130, 246, 0.03) 0%, transparent 70%);
        }

        .stat-label {
            font-size: 14px;
            color: #8B95A1;
            margin-bottom: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: #191F28;
            letter-spacing: -1px;
            margin-bottom: 8px;
            animation: countUp 1s ease-out;
        }

        .stat-unit {
            font-size: 18px;
            color: #4E5968;
            font-weight: 600;
        }

        .stat-change {
            font-size: 13px;
            color: #00C851;
            font-weight: 600;
        }

        /* ì°¨íŠ¸ ì¹´ë“œ */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: #191F28;
        }

        .chart-container {
            position: relative;
            height: 280px;
        }

        /* í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬ìŠ¤íŠ¸ */
        .portfolio-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 260px;    /* â­ ì¶”ê°€ */
            overflow-y: auto;     /* â­ ì¶”ê°€ */
            overflow-x: hidden;
        }
        /* â­ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ (ìƒˆë¡œ ì¶”ê°€) */
        .portfolio-list::-webkit-scrollbar {
            width: 6px;
        }

        .portfolio-list::-webkit-scrollbar-thumb {
            background-color: #E5E8EB;
            border-radius: 3px;
        }

        .portfolio-list::-webkit-scrollbar-thumb:hover {
            background-color: #D1D6DB;
        }

        .portfolio-list::-webkit-scrollbar-track {
            background-color: transparent;
        }

        .portfolio-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #F8FAFB;
            border-radius: 12px;
            transition: all 0.2s;
        }

        .portfolio-item:hover {
            background: #F2F4F6;
            transform: translateX(4px);
        }

        .stock-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stock-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #3182F6, #6B9EFF);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 700;
            color: white;
        }

        .stock-name {
            font-size: 15px;
            font-weight: 700;
            color: #191F28;
            margin-bottom: 4px;
        }

        .stock-ticker {
            font-size: 13px;
            color: #8B95A1;
        }

        .stock-value {
            text-align: right;
        }

        .stock-dividend {
            font-size: 15px;
            font-weight: 700;
            color: #3182F6;
            margin-bottom: 4px;
        }

        .stock-yield {
            font-size: 13px;
            color: #00C851;
        }

        /* ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .action-btn {
            flex: 1;
            padding: 16px;
            background: white;
            border: 2px solid #E5E8EB;
            border-radius: 12px;
            text-decoration: none;
            text-align: center;
            font-weight: 700;
            color: #4E5968;
            transition: all 0.2s;
        }

        .action-btn:hover {
            border-color: #3182F6;
            background: #F8FAFB;
            transform: translateY(-2px);
        }

        .action-btn-primary {
            background: linear-gradient(135deg, #3182F6, #1B64DA);
            color: white;
            border: none;
        }

        .action-btn-primary:hover {
            background: linear-gradient(135deg, #1B64DA, #0D47A1);
            transform: translateY(-2px);
        }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes countUp {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        /* ì• ë‹ˆë©”ì´ì…˜ ë”œë ˆì´ */
        .grid-3 .card:nth-child(1) { animation-delay: 0.1s; }
        .grid-3 .card:nth-child(2) { animation-delay: 0.2s; }
        .grid-3 .card:nth-child(3) { animation-delay: 0.3s; }
        .grid-2 .card:nth-child(1) { animation-delay: 0.4s; }
        .grid-2 .card:nth-child(2) { animation-delay: 0.5s; }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1024px) {
            .grid-3 { grid-template-columns: 1fr; }
            .grid-2 { grid-template-columns: 1fr; }
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 700;
            color: #191F28;
            margin-bottom: 12px;
        }

        .empty-desc {
            font-size: 15px;
            color: #8B95A1;
            margin-bottom: 32px;
        }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="nav-container">
        <a href="/dashboard" style="display: flex; align-items: center; text-decoration: none;">
            <img src="/images/favicon.png" alt="DIVY" style="height: 33px;">
            <span style="font-size: 25px; font-weight: 300; color: #3182F6;">DIVY</span>
        </a>
        <div class="nav-menu">
            <a href="/dashboard" style="color:#3182F6">í™ˆ</a>
            <a href="/calculator">ê³„ì‚°ê¸°</a>
            <a href="/goal">ëª©í‘œ</a>
            <a href="/calendar">ìº˜ë¦°ë”</a>
            <a href="/logout" style="color: #FF6B6B;">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>
</nav>

<div class="container">
    <!-- í—¤ë” -->
    <div class="dashboard-header">
        <div class="welcome-text">
            ğŸ‘‹ <span th:text="${session.userName}">ì‚¬ìš©ì</span>ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤
        </div>
        <div class="welcome-sub">ì˜¤ëŠ˜ë„ ë‹¹ì‹ ì˜ ìì‚°ì´ ì¼í•˜ê³  ìˆìŠµë‹ˆë‹¤</div>
    </div>

    <!-- ë¹ˆ ìƒíƒœ -->
    <div th:if="${stockCount == 0}" class="card">
        <div class="empty-state">
            <div class="empty-icon">ğŸ“­</div>
            <div class="empty-title">ì•„ì§ í¬íŠ¸í´ë¦¬ì˜¤ê°€ ë¹„ì–´ìˆì–´ìš”</div>
            <div class="empty-desc">ì²« ì£¼ì‹ì„ ì¶”ê°€í•˜ê³  ë°°ë‹¹ê¸ˆì„ í™•ì¸í•´ë³´ì„¸ìš”</div>
            <a href="/calculator" class="action-btn action-btn-primary" style="display: inline-block; max-width: 200px;">
                ì£¼ì‹ ì¶”ê°€í•˜ê¸° â†’
            </a>
        </div>
    </div>

    <!-- ë°ì´í„° ìˆì„ ë•Œ -->
    <div th:if="${stockCount > 0}">
        <!-- 3ê°œ ìˆ«ì ì¹´ë“œ -->
        <div class="grid-3">
            <div class="card stat-card">
                <div class="stat-label">
                    ğŸ’° ì—°ê°„ ì˜ˆìƒ ë°°ë‹¹ê¸ˆ
                </div>
                <div class="stat-value">
                    <span th:text="${#numbers.formatInteger(totalAnnual, 0, 'COMMA')}">0</span>
                    <span class="stat-unit">ì›</span>
                </div>
                <div class="stat-change">
                    ì›” í‰ê·  <span th:text="${#numbers.formatInteger(monthlyAvg, 0, 'COMMA')}">0</span>ì› ìˆ˜ë ¹
                </div>
            </div>

            <div class="card stat-card">
                <div class="stat-label">
                    ğŸ“Š ì´ ìì‚° í‰ê°€ì•¡
                </div>
                <div class="stat-value">
                    <span th:text="${#numbers.formatInteger(totalAssetValue, 0, 'COMMA')}">0</span>
                    <span class="stat-unit">ì›</span>
                </div>
                <div class="stat-change">
                    <span th:if="${totalAssetValue > 0}">
                        ë°°ë‹¹ë¥  <span th:text="${#numbers.formatDecimal(totalAnnual / totalAssetValue * 100, 1, 2)}">0.00</span>%
                    </span>
                    <span th:if="${totalAssetValue == 0}">
                        ì£¼ì‹ì„ ì¶”ê°€í•´ë³´ì„¸ìš”
                    </span>
                </div>
            </div>

            <div class="card stat-card">
                <div class="stat-label">
                    ğŸ“ˆ ë³´ìœ  ì¢…ëª© ìˆ˜
                </div>
                <div class="stat-value">
                    <span th:text="${stockCount}">0</span>
                    <span class="stat-unit">ê°œ</span>
                </div>
                <div class="stat-change">
                    <span th:text="${investmentStatus}">ë¶„ì‚° íˆ¬ì ì¤‘</span>
                </div>
            </div>
        </div>

        <!-- â­ ì°¨íŠ¸ + í¬íŠ¸í´ë¦¬ì˜¤ (2:1 ë¹„ìœ¨ë¡œ ë‚˜ë€íˆ) -->
        <div class="grid-2">
            <!-- ì›”ë³„ ì°¨íŠ¸ (2ì¹¸) -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ“… ì›”ë³„ ë°°ë‹¹ê¸ˆ ì¶”ì´</div>
                </div>
                <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>

            <!-- í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬ìŠ¤íŠ¸ (1ì¹¸) -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ’¼ ë‚´ í¬íŠ¸í´ë¦¬ì˜¤</div>
                </div>
                <div class="portfolio-list">
                    <div th:each="stock : ${stockDetails}" class="portfolio-item">
                        <div class="stock-info">
                            <div class="stock-icon" th:text="${#strings.substring(stock.ticker, 0, 1)}">S</div>
                            <div>
                                <div class="stock-name" th:text="${stock.name}">ì‚¼ì„±ì „ì</div>
                                <div class="stock-ticker">
                                    <span th:text="${stock.ticker}">005930</span> Â·
                                    <span th:text="${stock.quantity}">10</span>ì£¼
                                </div>
                            </div>
                        </div>
                        <div class="stock-value">
                            <div class="stock-dividend" th:text="${#numbers.formatInteger(stock.annualDividend, 0, 'COMMA')} + 'ì›'">
                                14,440ì›
                            </div>
                            <div class="stock-yield" th:text="${#numbers.formatDecimal(stock.dividendYield, 1, 2)} + '%'">
                                2.0%
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- â­ ëª©í‘œ ë‹¬ì„±ë¥  í”„ë¡œê·¸ë ˆìŠ¤ ë°” (ë…ë¦½ ì¹´ë“œ, ì „ì²´ ë„ˆë¹„) -->
        <div class="card" style="animation: fadeInUp 0.7s ease-out backwards; animation-delay: 0.6s;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div>
                    <div style="font-size: 24px; font-weight: 800; color: #3182F6;">
                        0% ë‹¬ì„±
                    </div>
                </div>
                <a href="/goal" style="padding: 10px 20px; background: #F8FAFB; color: #3182F6; border-radius: 10px; text-decoration: none; font-weight: 600; font-size: 14px; transition: 0.2s;">
                    ëª©í‘œ ì„¤ì •í•˜ê¸°
                </a>
            </div>

            <!-- í”„ë¡œê·¸ë ˆìŠ¤ ë°” -->
            <div style="background: #E5E8EB; border-radius: 20px; height: 28px; overflow: hidden; position: relative; margin-bottom: 12px;">
                <div id="goalProgressBar" style="
                    background: linear-gradient(90deg, #3182F6, #6B9EFF);
                    height: 100%;
                    border-radius: 20px;
                    width: 0%;
                    transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
                "></div>
            </div>

            <!-- í˜„ì¬/ëª©í‘œ ê¸ˆì•¡ -->
            <div style="display: flex; justify-content: space-between; font-size: 13px; color: #8B95A1;">
                <span>í˜„ì¬: <b style="color: #191F28;"><span th:text="${#numbers.formatInteger(monthlyAvg, 0, 'COMMA')}">0</span>ì›</b></span>
                <span>ëª©í‘œ: <b style="color: #191F28;">ë¯¸ì„¤ì •</b></span>
            </div>
        </div>

        <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
        <div class="action-buttons">
            <a href="/calculator" class="action-btn action-btn-primary">
                â• ì£¼ì‹ ì¶”ê°€í•˜ê¸°
            </a>
            <a href="/goal" class="action-btn">
                ğŸ¯ ëª©í‘œ ì„¤ì •í•˜ê¸°
            </a>
            <a href="/calendar" class="action-btn">
                ğŸ“… ìº˜ë¦°ë” ë³´ê¸°
            </a>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const monthlyData = /*[[${monthlyTotals}]]*/ [];

    const ctx = document.getElementById('monthlyChart');
    if (ctx) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'],
                datasets: [{
                    label: 'ì˜ˆìƒ ë°°ë‹¹ê¸ˆ',
                    data: monthlyData,
                    borderColor: '#3182F6',
                    backgroundColor: 'rgba(49, 130, 246, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    pointBackgroundColor: '#3182F6',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        cornerRadius: 8,
                        callbacks: {
                            label: (ctx) => ctx.parsed.y.toLocaleString() + 'ì›'
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: '#F2F4F6' },
                        ticks: {
                            callback: (v) => v.toLocaleString() + 'ì›'
                        }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });
    }
</script>

</body>
</html>